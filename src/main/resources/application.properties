# ===== CONSUMER CONFIGURATION =====
# Spring Cloud Stream creates a KafkaMessageListenerContainer that:
# 1. Uses a KafkaConsumer to subscribe to topic 'T1' (consumer group is auto-generated)
# 2. Deserializes using JsonDeserializer (default for POJOs) to PageEvent objects
# 3. Invokes the pageEventConsumer function with each message
# Note: The binding name follows convention: [functionName]-[in/out]-[index]
spring.cloud.stream.bindings.pageEventConsumer-in-0.destination=T1

# ===== SUPPLIER CONFIGURATION =====
# Configures a MessageProducer that:
# 1. Invokes pageEventSupplier every 1000ms (via ScheduledExecutorService)
# 2. Serializes output using JsonSerializer (default for POJOs)
# 3. Sends to topic 'T2' via KafkaTemplate
# Important: The supplier must be enabled via poller configuration
spring.cloud.stream.bindings.pageEventSupplier-out-0.destination=T2

# ===== KSTREAM PROCESSOR CONFIGURATION =====
# Creates a Kafka Streams processor that:
# 1. Consumes from topic 'T2' (as KStream<String, PageEvent>)
# 2. Applies your stream processing logic (filtering/mapping)
# 3. Produces to topic 'T3' (as KStream<String, Long>)
# Behind the scenes: Uses KafkaStreams binder with internal state store
spring.cloud.stream.bindings.kStreamFunction-in-0.destination=T2
spring.cloud.stream.bindings.kStreamFunction-out-0.destination=T3

# ===== FUNCTION REGISTRATION =====
# Registers functional beans to be bound to message channels:
# 1. Order defines composition chain when functions are combined
# 2. Each function gets input/output bindings based on its type:
#    - Consumer: input only (void return)
#    - Supplier: output only (no input)
#    - Function: both input and output
spring.cloud.function.definition=pageEventConsumer;pageEventSupplier; kStreamFunction

# ===== SUPPLIER POLLING CONFIG =====
# Configures the poller that triggers the supplier:
# 1. Uses TaskScheduler with fixed-delay (executes every 1000ms)
# 2. Without this, supplier would only execute once at startup
# 3. Alternative: use cron expressions for complex schedules
spring.cloud.stream.bindings.pageEventSupplier-out-0.producer.poller.fixed-delay=200

# ===== IMPLICIT DEFAULTS (GOOD TO KNOW) =====
# Default Kafka config (when not specified):
# bootstrap.servers=localhost:9092
# key.serializer=org.apache.kafka.common.serialization.StringSerializer
# value.serializer=org.springframework.kafka.support.serializer.JsonSerializer
# auto.offset.reset=latest
# group.id=anonymous.[randomId]
spring.cloud.stream.kafka.streams.binder.configuration.commit.interval.ms=1000
spring.cloud.stream.kafka.streams.binder.configuration.cache.max.bytes.buffering=0
spring.cloud.stream.kafka.streams.binder.configuration.default.deserialization.exception.handler=org.apache.kafka.streams.errors.LogAndContinueExceptionHandler
spring.cloud.stream.kafka.streams.binder.application-id=kStreamFunction-new